import pyrealsense2 as rs
import numpy as np

# Configure depth stream
pipeline = rs.pipeline()
config = rs.config()
config.enable_stream(rs.stream.depth, 640, 480, rs.format.z16, 30)

# Start streaming
pipeline.start(config)

# Obstacle detection threshold (meters)
OBSTACLE_THRESHOLD = 0.5

try:
    # Wait for a coherent set of frames
    frames = pipeline.wait_for_frames()
    depth_frame = frames.get_depth_frame()
    if not depth_frame:
        print("No depth frame received")
    else:
        # Get depth at center of frame
        width, height = depth_frame.get_width(), depth_frame.get_height()
        center_distance = depth_frame.get_distance(width // 2, height // 2)
        
        # Rule-based classification
        if center_distance < OBSTACLE_THRESHOLD:
            velocity = 0
            robot_status = "Robot Halted"
        else:
            velocity = 1.0  # Normal operation speed
            robot_status = "Robot Moving"
        
        # Output
        print(f"Distance to obstacle: {center_distance:.3f} m")
        print(f"Status: {robot_status}")
        print(f"Velocity: {velocity} m/s")
        print(f"Industry: Amazon Fulfillment Robots")

finally:
    pipeline.stop()
